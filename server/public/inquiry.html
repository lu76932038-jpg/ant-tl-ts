<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>询价解析测试</title>
  <style>
    body {font-family: 'Segoe UI', Tahoma, sans-serif; margin: 2rem; background: #f9f9f9;}
    textarea {width: 100%; height: 200px; margin-bottom: 1rem; font-size: 1rem;}
    select, button {padding: 0.5rem; font-size: 1rem;}
    .result {white-space: pre-wrap; background: #fff; padding: 1rem; border: 1px solid #ddd; margin-top: 1rem;}
  </style>
</head>
<body>
  <h1>询价解析测试</h1>
  <p>登录后即可使用本页面调用后端 AI 解析接口。</p>
  <textarea id="content" placeholder="在此粘贴询价文本"></textarea>
  <div>
    <label for="model">模型：</label>
    <select id="model">
      <option value="gemini">Gemini</option>
      <option value="deepseek">DeepSeek</option>
    </select>
    <button id="submitBtn">解析</button>
  </div>
  <h2>结果</h2>
  <div id="result" class="result"></div>

  <script>
    // 假设登录后 token 已保存在 localStorage 中，键名为 "token"
    const token = localStorage.getItem('token');
    if (!token) {
      document.body.innerHTML = '<p>请先登录后再访问此页面。</p>';
    }
    document.getElementById('submitBtn').addEventListener('click', async () => {
      const content = document.getElementById('content').value.trim();
      const model = document.getElementById('model').value;
      if (!content) { alert('请输入内容'); return; }
      const payload = { content, model, fileName: 'manual.txt' };
      try {
        const resp = await fetch('/api/analyze-inquiry', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(payload)
        });
        const data = await resp.json();
        document.getElementById('result').textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        document.getElementById('result').textContent = '请求出错: ' + e;
      }
    });
  </script>
</body>
</html>
