# 询价解析 2.0 优化建议清单 (Optimization Checklist)

基于当前架构，以下是后续版本可考虑的优化方向：

## 1. 架构与性能 (Architecture & Performance)

- [ ] **异步任务队列 (Async Queue)**:
  - **现状**: 上传接口同步等待 AI 解析，大文件（如 50页 PDF）可能导致 HTTP 超时。
  - **建议**: 引入 Redis + BullMQ。上传后立即返回 TaskID，后台异步处理解析，前端轮询或通过 WebSocket 接收完成通知。
- [ ] **对象存储 (Object Storage)**:
  - **现状**: 文件存储在服务器本地磁盘 (`server/uploads`)。
  - **建议**: 迁移至 AWS S3 / Aliyun OSS。支持更可靠的备份、CDN 加速及预签名 URL 下载，减轻应用服务器 IO 压力。

## 2. 数据库模型 (Database Improvements)

- [ ] **规范化分享关系 (Normalized Sharing)**:
  - **现状**: `shared_with` 字段存储 JSON 数组 `[1, 2, 3]`。
  - **建议**: 拆分为多对多关联表 `inquiry_shares` (task_id, user_id, permission_level, expires_at)。支持更细粒度的权限控制（如只读/可编辑）和分享有效期。

## 3. 用户体验 (User Experience)

- [ ] **实时状态反馈 (Real-time Feedback)**:
  - **现状**: 用户需手动刷新列表查看状态。
  - **建议**: 使用 WebSocket (Socket.io) 或 SSE (Server-Sent Events) 推送任务状态变更。
- [ ] **进度条与预览**:
  - **建议**: 上传时显示进度条；下载前提供简单的在线预览（如 PDF 预览）。

## 4. AI 解析能力 (AI Capability)

- [ ] **长文档切片 (Document Chunking)**:
  - **现状**: 简单估算 Token 数。
  - **建议**: 对超长文档进行智能切片（Chunking），分段发送给 AI 解析后再合并结果，突破 Token 限制并提高精准度。
- [ ] **多模型切换 (Model Fallback)**:
  - **建议**: 当首选模型 (如 Deepseek) 响应慢或失败时，自动降级切换到备用模型 (如 Gemini/OpenAI)。

## 5. 安全与运维 (Security & Ops)

- [ ] **自动清理策略 (Auto-Cleanup)**:
  - **建议**: 增加定时任务 (Cron Job)，自动删除超过 30 天的原始文件以释放空间（仅保留解析结果）。
- [ ] **文件安全扫描**:
  - **建议**: 上传时增加病毒扫描步骤。

## 6. 功能聚合与合并 (Feature Merging & Unification)

- [ ] **多任务合并导出 (Batch Merge Export)**:
  - **场景**: 用户上传了 5 个图片作为同一个项目的询价单。
  - **建议**: 在历史列表中增加“复选框”，用户勾选多个任务后，点击“合并导出”，系统将多个解析结果整合成一个 Excel 文件下载。
- [ ] **界面合并 (UI Unification)**:
  - **现状**: `MainApp` (上传页) 和 `InquiryHistory` (历史页) 是分开的。
  - **建议**: 将两者合并为“询价任务中心”。首页即为任务列表，列表上方提供“新建上传”区域（或弹窗）。这样用户上传完立即能看到列表更新，操作链路更短。
